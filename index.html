<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hướng Dẫn Công Thức Pha Chế</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .accordion-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 1rem;
            font-weight: 600;
            font-size: 1.125rem;
            background: linear-gradient(to right, #f9fafb, #f3f4f6);
            color: #374151;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        .accordion-button:hover {
            background: linear-gradient(to right, #f3f4f6, #e5e7eb);
        }
        .accordion-button::after {
            content: '\25BC';
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        .accordion-button.open::after {
            transform: rotate(180deg);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            background-color: #f9fafb;
            color: #4b5563;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            border-radius: 0 0 0.5rem 0.5rem;
        }
        .accordion-content.open {
            max-height: 2000px;
            padding: 1rem;
        }
        .nav-link {
            transition: all 0.2s ease;
            display: block;
            padding: 0.5rem 0;
        }
        .nav-link:hover {
            color: #2563eb;
            transform: translateX(5px);
        }
        .section-title {
            position: relative;
            display: inline-block;
            margin-bottom: 1.5rem;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 50%;
            height: 3px;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        .section-title:hover::after {
            width: 100%;
        }
        .recipe-card {
            background: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }
        .recipe-actions {
            display: flex;
            justify-content: flex-end;
            padding: 0.5rem 1rem;
            background-color: #f9fafb;
            border-top: 1px solid #e5e7eb;
        }
        .recipe-actions button {
            margin-left: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .recipe-actions button:hover {
            transform: translateY(-1px);
        }
        .edit-btn {
            color: #2563eb;
            background-color: #eff6ff;
        }
        .edit-btn:hover {
            background-color: #dbeafe;
        }
        .delete-btn {
            color: #dc2626;
            background-color: #fef2f2;
        }
        .delete-btn:hover {
            background-color: #fee2e2;
        }
        .message {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        .error-message {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        .success-message {
            background-color: #d1fae5;
            color: #065f46;
        }
        main {
            flex: 1;
        }
    </style>
</head>
<body>
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-8 text-center shadow-lg">
        <h1 class="text-4xl font-bold tracking-tight hover:text-blue-200 transition-colors duration-300">Hướng Dẫn Công Thức Pha Chế</h1>
    </header>

    <main class="container mx-auto p-6 max-w-5xl">
        <div id="messages" class="mb-4"></div>

        <div class="mb-6 flex flex-wrap gap-2">
            <button onclick="openModal('add')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                Thêm Công Thức
            </button>
            <button onclick="resetToDefault()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                Khôi phục mặc định
            </button>
        </div>

        <nav class="bg-white shadow-xl rounded-2xl p-6 mb-8 transition-transform duration-300 hover:shadow-2xl">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 section-title">Mục Lục</h2>
            <ul class="space-y-2">
                <li><a href="#feca" class="text-blue-600 hover:underline nav-link">Feca Pha Chế</a></li>
                <li><a href="#coffee" class="text-blue-600 hover:underline nav-link">Cà Phê</a></li>
                <li><a href="#frappe" class="text-blue-600 hover:underline nav-link">Đá Xay</a></li>
                <li><a href="#matcha" class="text-blue-600 hover:underline nav-link">Matcha</a></li>
                <li><a href="#tea" class="text-blue-600 hover:underline nav-link">Trà Sữa & Trà</a></li>
            </ul>
        </nav>

        <section id="feca" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Feca Pha Chế</h2>
            <div class="space-y-4" id="feca-recipes"></div>
        </section>

        <section id="coffee" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Cà Phê</h2>
            <div class="space-y-4" id="coffee-recipes"></div>
        </section>

        <section id="matcha" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Matcha</h2>
            <div class="space-y-4" id="matcha-recipes"></div>
        </section>

        <section id="frappe" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Đá Xay</h2>
            <div class="space-y-4" id="frappe-recipes"></div>
        </section>

        <section id="tea" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Trà Sữa & Trà</h2>
            <div class="space-y-4" id="tea-recipes"></div>
        </section>

        <!-- Modal -->
        <div id="recipeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                <h2 id="modalTitle" class="text-2xl font-bold mb-4">Thêm Công Thức</h2>
                <form id="recipeForm" class="space-y-4">
                    <div>
                        <label for="recipeName" class="block font-medium mb-1">Tên Công Thức</label>
                        <input type="text" id="recipeName" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="recipeSection" class="block font-medium mb-1">Phần</label>
                        <select id="recipeSection" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="feca">Feca Pha Chế</option>
                            <option value="coffee">Cà Phê</option>
                            <option value="frappe">Đá Xay</option>
                            <option value="matcha">Matcha</option>
                            <option value="tea">Trà Sữa & Trà</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="recipeIngredients" class="block font-medium mb-1">Nguyên Liệu</label>
                        <textarea id="recipeIngredients" rows="3" placeholder="Nhập nguyên liệu (mỗi dòng một nguyên liệu)"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div>
                        <label for="recipeInstructions" class="block font-medium mb-1">Cách Làm</label>
                        <textarea id="recipeInstructions" rows="3" placeholder="Nhập cách làm (mỗi dòng một bước)"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div>
                        <label for="recipeNotes" class="block font-medium mb-1">Ghi Chú (Tùy chọn)</label>
                        <textarea id="recipeNotes" rows="2" placeholder="Nhập ghi chú nếu có"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <input type="hidden" id="recipeId">
                    
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeModal()" 
                            class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors">
                            Hủy
                        </button>
                        <button type="submit" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                            Lưu
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white text-center py-6">
        <p class="text-sm">© 2025 Công Thức Pha Chế</p>
        <p class="text-sm mt-2">Liên hệ: <a href="mailto:info@phache.com" class="hover:text-blue-300 transition-colors">info@phache.com</a></p>
    </footer>

    <script>
        // Default recipes data
        const defaultRecipes = {
            feca: [
                { 
                    id: 'feca1', 
                    name: 'Công thức nấu Tofu', 
                    ingredients: ['Bột tofu (tàu hủ): 100g', 'Nước: 500ml'], 
                    instructions: [
                        'Giảm lửa xuống 800 (riu lửa).',
                        'Vừa đổ bột vào vừa khuấy đều bằng muỗng.',
                        'Khuấy xong, vừa lên tím thì tắt lửa.',
                        'Cho trực tiếp vào hủ đựng tofu với 40g.'
                    ], 
                    notes: '' 
                },
                // Thêm các công thức khác tương tự
            ],
            coffee: [
                { 
                    id: 'coffee1', 
                    name: 'Espresso Đá', 
                    ingredients: [
                        'Cà phê máy 1 shot',
                        '80% ngọt: 6ml đường',
                        '100% ngọt: 8ml đường',
                        '120% ngọt: 10ml đường'
                    ], 
                    instructions: ['Trình bày đá riêng'], 
                    notes: '' 
                },
                // Thêm các công thức khác tương tự
            ],
            // Các phần khác tương tự
        };

        let recipes = JSON.parse(JSON.stringify(defaultRecipes));

        // Hàm tạo ID ngẫu nhiên
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Hiển thị thông báo
        function showMessage(message, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message message' : 'success-message message';
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Reset về công thức mặc định
        function resetToDefault() {
            if (confirm('Bạn có chắc muốn khôi phục về công thức mặc định? Tất cả thay đổi sẽ bị mất.')) {
                recipes = JSON.parse(JSON.stringify(defaultRecipes));
                renderRecipes();
                showMessage('Đã khôi phục về công thức mặc định!');
            }
        }

        // Mở modal
        function openModal(mode, recipe = null) {
            const modal = document.getElementById('recipeModal');
            const form = document.getElementById('recipeForm');
            const title = document.getElementById('modalTitle');
            
            if (mode === 'edit' && recipe) {
                title.textContent = 'Sửa Công Thức';
                document.getElementById('recipeName').value = recipe.name;
                document.getElementById('recipeSection').value = recipe.section || 'feca';
                document.getElementById('recipeIngredients').value = recipe.ingredients.join('\n');
                document.getElementById('recipeInstructions').value = recipe.instructions.join('\n');
                document.getElementById('recipeNotes').value = recipe.notes || '';
                document.getElementById('recipeId').value = recipe.id;
            } else {
                title.textContent = 'Thêm Công Thức';
                form.reset();
                document.getElementById('recipeId').value = '';
            }
            
            modal.classList.remove('hidden');
        }

        // Đóng modal
        function closeModal() {
            document.getElementById('recipeModal').classList.add('hidden');
        }

        // Render danh sách công thức
        function renderRecipes() {
            const sections = ['feca', 'coffee', 'frappe', 'matcha', 'tea'];
            
            sections.forEach(section => {
                const container = document.getElementById(`${section}-recipes`);
                if (!container) return;
                
                container.innerHTML = '';
                
                if (!recipes[section] || !Array.isArray(recipes[section])) {
                    container.innerHTML = '<div class="error-message message">Không tìm thấy công thức. Vui lòng thêm công thức mới.</div>';
                    return;
                }
                
                recipes[section].forEach(recipe => {
                    const recipeDiv = document.createElement('div');
                    recipeDiv.className = 'recipe-card';
                    
                    recipeDiv.innerHTML = `
                        <button class="accordion-button" onclick="toggleAccordion(this)">
                            ${recipe.name}
                        </button>
                        <div class="accordion-content">
                            ${recipe.ingredients.length ? `
                                <p class="font-medium mb-1">Nguyên liệu:</p>
                                <ul class="list-disc pl-6 mb-3">
                                    ${recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}
                                </ul>
                            ` : ''}
                            
                            ${recipe.instructions.length ? `
                                <p class="font-medium mb-1">Cách làm:</p>
                                <ul class="list-disc pl-6 mb-3">
                                    ${recipe.instructions.map(ins => `<li>${ins}</li>`).join('')}
                                </ul>
                            ` : ''}
                            
                            ${recipe.notes ? `
                                <p class="font-medium mb-1">Ghi chú:</p>
                                <p class="pl-2">${recipe.notes}</p>
                            ` : ''}
                        </div>
                        <div class="recipe-actions">
                            <button onclick="editRecipe('${recipe.id}', '${section}')" class="edit-btn">
                                Sửa
                            </button>
                            <button onclick="deleteRecipe('${recipe.id}', '${section}')" class="delete-btn">
                                Xóa
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(recipeDiv);
                });
            });
        }

        // Toggle accordion
        function toggleAccordion(button) {
            const content = button.nextElementSibling;
            button.classList.toggle('open');
            content.classList.toggle('open');
        }

        // Chỉnh sửa công thức
        function editRecipe(id, section) {
            const recipe = recipes[section].find(r => r.id === id);
            if (recipe) {
                openModal('edit', { ...recipe, section });
            }
        }

        // Xóa công thức
        function deleteRecipe(id, section) {
            if (confirm('Bạn có chắc muốn xóa công thức này?')) {
                recipes[section] = recipes[section].filter(r => r.id !== id);
                renderRecipes();
                showMessage('Đã xóa công thức!');
            }
        }

        // Xử lý submit form
        document.getElementById('recipeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('recipeId').value || generateUUID();
            const section = document.getElementById('recipeSection').value;
            const name = document.getElementById('recipeName').value.trim();
            const ingredients = document.getElementById('recipeIngredients').value
                .split('\n')
                .filter(line => line.trim());
            const instructions = document.getElementById('recipeInstructions').value
                .split('\n')
                .filter(line => line.trim());
            const notes = document.getElementById('recipeNotes').value.trim();

            // Validate
            if (!name) {
                showMessage('Vui lòng nhập tên công thức', 'error');
                return;
            }

            // Remove old recipe if editing
            if (document.getElementById('recipeId').value) {
                Object.keys(recipes).forEach(sec => {
                    recipes[sec] = recipes[sec].filter(r => r.id !== id);
                });
            }

            // Add new recipe
            if (!recipes[section]) recipes[section] = [];
            recipes[section].push({ 
                id, 
                name, 
                ingredients, 
                instructions, 
                notes 
            });
            
            renderRecipes();
            closeModal();
            showMessage(
                document.getElementById('recipeId').value 
                    ? 'Đã cập nhật công thức!' 
                    : 'Đã thêm công thức mới!'
            );
        });

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', () => {
            renderRecipes();
        });
    </script>
</body>
</html>
