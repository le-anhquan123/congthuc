<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H∆∞·ªõng D·∫´n C√¥ng Th·ª©c Pha Ch·∫ø</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        .accordion-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            text-left: p-5;
            font-semibold: text-lg;
            bg-gradient-to-r: from-gray-50 to-gray-100;
            text-gray-700;
            padding: 1rem;
            border: none;
            background: linear-gradient(to right, #f9fafb, #f3f4f6);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .accordion-button:hover {
            background-color: #e5e7eb;
        }
        .accordion-button::after {
            content: '\25BC';
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        .accordion-button.open::after {
            transform: rotate(180deg);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            padding: 0 1rem;
            background-color: #f9fafb;
            color: #4b5563;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
        }
        .accordion-content.open {
            max-height: 2000px;
            padding: 1rem;
        }
        .nav-link {
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .nav-link:hover {
            color: #1d4ed8;
            transform: translateX(5px);
        }
        .section-title {
            position: relative;
            display: inline-block;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 50%;
            height: 3px;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        .section-title:hover::after {
            width: 100%;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal.open {
            display: flex;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .modal-content h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .modal-content label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .modal-content input, .modal-content textarea, .modal-content select {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }
        .modal-content textarea {
            min-height: 100px;
        }
        .modal-content button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            margin-right: 0.5rem;
        }
        .error-message {
            background: #fee2e2;
            color: #b91c1c;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .share-section {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .share-url {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            padding: 0.5rem;
            word-break: break-all;
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-8 text-center shadow-lg">
        <h1 class="text-4xl font-bold tracking-tight hover:text-blue-200 transition-colors duration-300">H∆∞·ªõng D·∫´n C√¥ng Th·ª©c Pha Ch·∫ø</h1>
    </header>

    <main class="container mx-auto p-6 max-w-5xl">
        <div id="messages"></div>
        
        <div class="share-section">
            <h3 class="font-semibold mb-2">üîó Chia s·∫ª c√¥ng th·ª©c</h3>
            <p class="text-sm text-gray-600 mb-2">Link n√†y s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª± ƒë·ªông khi b·∫°n th√™m/s·ª≠a c√¥ng th·ª©c:</p>
            <div class="share-url" id="shareUrl">ƒêang t·∫°o link...</div>
            <button onclick="copyShareUrl()" class="mt-2 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">Sao ch√©p link</button>
        </div>

        <div class="mb-6">
            <button onclick="openModal('add')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-2">Th√™m C√¥ng Th·ª©c</button>
            <button onclick="resetToDefault()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh</button>
        </div>

        <nav class="bg-white shadow-xl rounded-2xl p-6 mb-8 transform hover:scale-[1.01] transition-transform duration-300">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 section-title">M·ª•c L·ª•c</h2>
            <ul class="space-y-3">
                <li><a href="#feca" class="text-blue-600 hover:underline nav-link block">Feca Pha Ch·∫ø</a></li>
                <li><a href="#coffee" class="text-blue-600 hover:underline nav-link block">C√† Ph√™</a></li>
                <li><a href="#frappe" class="text-blue-600 hover:underline nav-link block">ƒê√° Xay</a></li>
                <li><a href="#matcha" class="text-blue-600 hover:underline nav-link block">Matcha</a></li>
                <li><a href="#tea" class="text-blue-600 hover:underline nav-link block">Tr√† S·ªØa & Tr√†</a></li>
            </ul>
        </nav>

        <section id="feca" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Feca Pha Ch·∫ø</h2>
            <div class="space-y-4" id="feca-recipes"></div>
        </section>

        <section id="coffee" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">C√† Ph√™</h2>
            <div class="space-y-4" id="coffee-recipes"></div>
        </section>

        <section id="matcha" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Matcha</h2>
            <div class="space-y-4" id="matcha-recipes"></div>
        </section>

        <section id="frappe" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">ƒê√° Xay</h2>
            <div class="space-y-4" id="frappe-recipes"></div>
        </section>

        <section id="tea" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Tr√† S·ªØa & Tr√†</h2>
            <div class="space-y-4" id="tea-recipes"></div>
        </section>

        <div id="recipeModal" class="modal">
            <div class="modal-content">
                <h2 id="modalTitle">Th√™m C√¥ng Th·ª©c</h2>
                <form id="recipeForm">
                    <label for="recipeName">T√™n C√¥ng Th·ª©c</label>
                    <input type="text" id="recipeName" required>
                    <label for="recipeSection">Ph·∫ßn</label>
                    <select id="recipeSection" required>
                        <option value="feca">Feca Pha Ch·∫ø</option>
                        <option value="coffee">C√† Ph√™</option>
                        <option value="frappe">ƒê√° Xay</option>
                        <option value="matcha">Matcha</option>
                        <option value="tea">Tr√† S·ªØa & Tr√†</option>
                    </select>
                    <label for="recipeIngredients">Nguy√™n Li·ªáu</label>
                    <textarea id="recipeIngredients" placeholder="Nh·∫≠p nguy√™n li·ªáu (m·ªói d√≤ng m·ªôt nguy√™n li·ªáu)"></textarea>
                    <label for="recipeInstructions">C√°ch L√†m</label>
                    <textarea id="recipeInstructions" placeholder="Nh·∫≠p c√°ch l√†m (m·ªói d√≤ng m·ªôt b∆∞·ªõc)"></textarea>
                    <label for="recipeNotes">Ghi Ch√∫ (T√πy ch·ªçn)</label>
                    <textarea id="recipeNotes" placeholder="Nh·∫≠p ghi ch√∫ n·∫øu c√≥"></textarea>
                    <input type="hidden" id="recipeId">
                    <div class="flex justify-end">
                        <button type="button" onclick="closeModal()" class="bg-gray-500 text-white hover:bg-gray-600">H·ªßy</button>
                        <button type="submit" class="bg-blue-600 text-white hover:bg-blue-700">L∆∞u</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white text-center py-6">
        <p class="text-sm">¬© 2025 C√¥ng Th·ª©c Pha Ch·∫ø</p>
        <p class="text-sm mt-2">Li√™n h·ªá: <a href="mailto:info@phache.com" class="hover:text-blue-300 transition-colors">info@phache.com</a></p>
    </footer>

    <script>
        // Default recipes data
        const defaultRecipes = {
            feca: [
                { id: 'feca1', name: 'C√¥ng th·ª©c n·∫•u Tofu', ingredients: ['B·ªôt tofu (t√†u h·ªß): 100g', 'N∆∞·ªõc: 500ml'], instructions: ['Gi·∫£m l·ª≠a xu·ªëng 800 (riu l·ª≠a).', 'V·ª´a ƒë·ªï b·ªôt v√†o v·ª´a khu·∫•y ƒë·ªÅu b·∫±ng mu·ªóng.', 'Khu·∫•y xong, v·ª´a l√™n t√≠m th√¨ t·∫Øt l·ª≠a.', 'Cho tr·ª±c ti·∫øp v√†o h·ªß ƒë·ª±ng tofu v·ªõi 40g.'], notes: '' },
                { id: 'feca2', name: 'C√¥ng th·ª©c n·∫•u H·ªìng Tr√† (Tr√† tr√°i c√¢y)', ingredients: ['H·ªìng tr√†: 100g', 'N∆∞·ªõc: 1.400ml', 'ƒê√°: 400g'], instructions: ['ƒê·ªÉ n∆∞·ªõc s√¥i v√†o ca ƒëong, b·∫•m ƒë·ªìng h·ªì 2 ph√∫t ƒë·ªÉ gi·∫£m nhi·ªát ƒë·ªô n∆∞·ªõc.', 'B·ªè tr√† v√†o, ƒë·∫≠y n·∫Øp h·ªü, ·ªß trong 12 ph√∫t.', '·ª¶ xong, l·∫•y ra cho ch·∫£y h·∫øt n∆∞·ªõc t·ª± nhi√™n (kh√¥ng v·∫Øt).', 'Cho ƒë√° v√†o.'], notes: '' },
                { id: 'feca3', name: 'C√¥ng th·ª©c n·∫•u Olong + H·ªìng Tr√† (Olong S·ªØa, 2 m·∫ª)', ingredients: ['Olong: 160g', 'H·ªìng tr√†: 40g', 'N∆∞·ªõc: 2.000ml', 'N∆∞·ªõc ƒë√°: 400g'], instructions: ['·ª¶ trong 20 ph√∫t.', 'Cho n∆∞·ªõc ƒë√° v√†o.'], notes: '' },
                { id: 'feca4', name: 'C√¥ng th·ª©c n·∫•u H·ªìng Tr√† S·ªØa (2 m·∫ª)', ingredients: ['H·ªìng tr√†: 200g', 'N∆∞·ªõc: 2.000ml', 'N∆∞·ªõc ƒë√°: 400g'], instructions: ['·ª¶ trong 20 ph√∫t.', 'Cho n∆∞·ªõc ƒë√° v√†o.'], notes: '' },
                { id: 'feca5', name: 'Kem S·ªØa', ingredients: ['S·ªØa t∆∞∆°i (kh·ªëi l∆∞·ª£ng nh·ªè): 50g', 'ON TOP (kh·ªëi l∆∞·ª£ng nh·ªè): 105g', 'S·ªØa t∆∞∆°i (kh·ªëi l∆∞·ª£ng l·ªõn): 100g', 'ON TOP (kh·ªëi l∆∞·ª£ng l·ªõn): 210g'], instructions: [], notes: 'Cho to√†n b·ªô nguy√™n li·ªáu v√†o ca, khu·∫•y ƒë·ªÅu cho h·ª£p, nguy√™n li·ªáu c√≥ th·ªÉ, sau ƒë√≥ s·ª≠ d·ª•ng m√°y ƒë√°nh kem ƒë√°nh ·ªü m·ª©c 4 trong 35s th√™m 5s n·∫øu th·∫•y v·∫´n c√≤n l·ªèng.' }
            ],
            coffee: [
                { id: 'coffee1', name: 'Espresso ƒê√°', ingredients: ['C√† ph√™ m√°y 1 shot', '80% ng·ªçt: 6ml ƒë∆∞·ªùng', '100% ng·ªçt: 8ml ƒë∆∞·ªùng', '120% ng·ªçt: 10ml ƒë∆∞·ªùng'], instructions: ['Tr√¨nh b√†y ƒë√° ri√™ng'], notes: '' },
                { id: 'coffee2', name: 'Espresso S·ªØa ƒê√°', ingredients: ['C√† ph√™ m√°y 1 shot', '80% ng·ªçt: 14g s·ªØa ƒë·∫∑c', '100% ng·ªçt: 28g s·ªØa ƒë·∫∑c', '120% ng·ªçt: 42g s·ªØa ƒë·∫∑c'], instructions: ['Tr√¨nh b√†y ƒë√° ri√™ng'], notes: '' }
            ],
            matcha: [
                { id: 'matcha1', name: 'Matcha Coco', ingredients: ['N∆∞·ªõc d·ª´a: 150ml', 'N∆∞·ªõc ƒë∆∞·ªùng: 23g (2 pump)', 'Kem Matcha: 70g (150ml)'], instructions: ['Khu·∫•y ƒë·ªÅu sau ƒë√≥ ƒë·ªï ƒë√° ngang mi·ªáng ly, trang tr√≠ b·ªôt matcha'], notes: '' }
            ],
            frappe: [
                { id: 'frappe1', name: 'Cookie ƒê√° Xay', ingredients: ['5 Oreo (4.5 cho v√†o c·ªëi, 0.5 trang tr√≠)', 'S·ªØa t∆∞∆°i: 70g', 'Rick l√πn: 60g', 'B·ªôt Frappe: 20g', 'ƒê∆∞·ªùng c√°t: 30g', '1 ly ƒë√° L'], instructions: ['Xay h·ªón h·ª£p t·ªõi khi ƒë√° n√°t v√† ƒë·ªï ra ly, x·ªãt kem l√™n tr√™n v√† trang tr√≠ 0.5 Oreo ƒë·∫≠p v·ª•n r·∫Øc l√™n b·ªÅ m·∫∑t'], notes: '' }
            ],
            tea: [
                { id: 'tea1', name: 'Feca Olong S·ªØa', ingredients: ['C·ªët tr√† s·ªØa olong: 80g (size M), 120g (size L)', 'B·ªôt s·ªØa Frima: 10g (size M), 15g (size L)', 'S·ªØa ƒë·∫∑c Lamosa 80%: 23g (size M), 45g (size L)', 'S·ªØa ƒë·∫∑c Lamosa 100%: 45g (size M), 60g (size L)', 'S·ªØa ƒë·∫∑c Lamosa 120%: 60g (size M), 75g (size L)'], instructions: ['Khu·∫•y ƒë·ªÅu nh·∫π tay, s·ª≠ d·ª•ng s·ª•c ƒë·ªÉ ƒë√°nh v·ªã v√† h∆∞∆°ng l√™n, sau khi s·ª•c khu·∫•y tan b·ªôt s·ªØa v√† cho ƒë√° v√†o'], notes: '1 pump = 12/13g' }
            ]
        };

        let recipes = JSON.parse(JSON.stringify(defaultRecipes));

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function showMessage(message, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        function compressData(data) {
            try {
                return btoa(encodeURIComponent(JSON.stringify(data)));
            } catch (e) {
                console.error('Compression failed:', e);
                return null;
            }
        }

        function decompressData(compressed) {
            try {
                return JSON.parse(decodeURIComponent(atob(compressed)));
            } catch (e) {
                console.error('Decompression failed:', e);
                return null;
            }
        }

        function updateShareUrl() {
            try {
                const compressed = compressData(recipes);
                if (compressed) {
                    const currentUrl = new URL(window.location);
                    currentUrl.searchParams.set('data', compressed);
                    const shareUrl = currentUrl.toString();
                    document.getElementById('shareUrl').textContent = shareUrl;
                    
                    // Update browser URL without page reload
                    window.history.replaceState({}, '', shareUrl);
                }
            } catch (e) {
                console.error('Failed to update share URL:', e);
                document.getElementById('shareUrl').textContent = 'L·ªói t·∫°o link chia s·∫ª';
            }
        }

        function copyShareUrl() {
            const shareUrl = document.getElementById('shareUrl').textContent;
            if (shareUrl && shareUrl !== 'ƒêang t·∫°o link...' && shareUrl !== 'L·ªói t·∫°o link chia s·∫ª') {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    showMessage('ƒê√£ sao ch√©p link chia s·∫ª!');
                }).catch(() => {
                    showMessage('Kh√¥ng th·ªÉ sao ch√©p link. Vui l√≤ng sao ch√©p th·ªß c√¥ng.', 'error');
                });
            }
        }

        function loadDataFromUrl() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const compressedData = urlParams.get('data');
                
                if (compressedData) {
                    const decompressed = decompressData(compressedData);
                    if (decompressed) {
                        recipes = decompressed;
                        showMessage('ƒê√£ t·∫£i d·ªØ li·ªáu t·ª´ link chia s·∫ª!');
                        return true;
                    }
                }
                return false;
            } catch (e) {
                console.error('Failed to load data from URL:', e);
                showMessage('L·ªói khi t·∫£i d·ªØ li·ªáu t·ª´ link', 'error');
                return false;
            }
        }

        function resetToDefault() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën kh√¥i ph·ª•c v·ªÅ c√¥ng th·ª©c m·∫∑c ƒë·ªãnh? T·∫•t c·∫£ thay ƒë·ªïi s·∫Ω b·ªã m·∫•t.')) {
                recipes = JSON.parse(JSON.stringify(defaultRecipes));
                renderRecipes();
                updateShareUrl();
                showMessage('ƒê√£ kh√¥i ph·ª•c v·ªÅ c√¥ng th·ª©c m·∫∑c ƒë·ªãnh!');
            }
        }

        function toggleAccordion(button) {
            try {
                const content = button.nextElementSibling;
                if (!content || !content.classList.contains('accordion-content')) {
                    return;
                }
                const isOpen = content.classList.contains('open');
                content.classList.toggle('open', !isOpen);
                button.classList.toggle('open', !isOpen);
            } catch (e) {
                console.error('Error in toggleAccordion:', e);
            }
        }

        function openModal(mode, recipe = null) {
            try {
                const modal = document.getElementById('recipeModal');
                const form = document.getElementById('recipeForm');
                const title = document.getElementById('modalTitle');
                const recipeName = document.getElementById('recipeName');
                const recipeSection = document.getElementById('recipeSection');
                const recipeIngredients = document.getElementById('recipeIngredients');
                const recipeInstructions = document.getElementById('recipeInstructions');
                const recipeNotes = document.getElementById('recipeNotes');
                const recipeId = document.getElementById('recipeId');

                if (mode === 'edit' && recipe) {
                    title.textContent = 'S·ª≠a C√¥ng Th·ª©c';
                    recipeName.value = recipe.name;
                    recipeSection.value = recipe.section || 'frappe';
                    recipeIngredients.value = recipe.ingredients.join('\n');
                    recipeInstructions.value = recipe.instructions.join('\n');
                    recipeNotes.value = recipe.notes || '';
                    recipeId.value = recipe.id;
                } else {
                    title.textContent = 'Th√™m C√¥ng Th·ª©c';
                    form.reset();
                    recipeId.value = '';
                }

                modal.classList.add('open');
            } catch (e) {
                console.error('Error opening modal:', e);
            }
        }

        function closeModal() {
            try {
                document.getElementById('recipeModal').classList.remove('open');
            } catch (e) {
                console.error('Error closing modal:', e);
            }
        }

        function renderRecipes() {
            try {
                const sections = ['feca', 'coffee', 'frappe', 'matcha', 'tea'];
                sections.forEach(section => {
                    const container = document.getElementById(`${section}-recipes`);
                    if (!container) {
                        return;
                    }
                    container.innerHTML = '';

                    if (!recipes[section] || !Array.isArray(recipes[section])) {
                        container.innerHTML = `<div class="error-message">Kh√¥ng t√¨m th·∫•y c√¥ng th·ª©c cho ${section}. Vui l√≤ng th√™m c√¥ng th·ª©c m·ªõi.</div>`;
                        return;
                    }

                    recipes[section].forEach(recipe => {
                        const recipeDiv = document.createElement('div');
                        recipeDiv.className = 'bg-white shadow-md rounded-xl overflow-hidden';
                        recipeDiv.innerHTML = `
                            <button class="accordion-button w-full text-left p-5 font-semibold text-lg bg-gradient-to-r from-gray-50 to-gray-100 text-gray-700" onclick="toggleAccordion(this)">${recipe.name}</button>
                            <div class="accordion-content bg-gray-50 text-gray-600">
                                ${recipe.ingredients && recipe.ingredients.length ? `<p><strong>Nguy√™n li·ªáu:</strong></p><ul class="list-disc pl-6">${recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}</ul>` : ''}
                                ${recipe.instructions && recipe.instructions.length ? `<p><strong>C√°ch l√†m:</strong></p><ul class="list-disc pl-6">${recipe.instructions.map(ins => `<li>${ins}</li>`).join('')}</ul>` : ''}
                                ${recipe.notes ? `<p><strong>Ghi ch√∫:</strong> ${recipe.notes}</p>` : ''}
                            </div>
                            <div class="flex justify-end p-2">
                                <button onclick="editRecipe('${recipe.id}', '${section}')" class="text-blue-600 hover:text-blue-800 mr-2">S·ª≠a</button>
                                <button onclick="deleteRecipe('${recipe.id}', '${section}')" class="text-red-600 hover:text-red-800">X√≥a</button>
                            </div>
                        `;
                        container.appendChild(recipeDiv);
                    });
                });
            } catch (e) {
                console.error('Error in renderRecipes:', e);
            }
        }

        function editRecipe(id, section) {
            try {
                const recipe = recipes[section].find(r => r.id === id);
                if (recipe) {
                    openModal('edit', { ...recipe, section });
                }
            } catch (e) {
                console.error('Error editing recipe:', e);
            }
        }

        function deleteRecipe(id, section) {
            try {
                if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a c√¥ng th·ª©c n√†y?')) {
                    recipes[section] = recipes[section].filter(r => r.id !== id);
                    renderRecipes();
                    updateShareUrl();
                    showMessage('ƒê√£ x√≥a c√¥ng th·ª©c!');
                }
            } catch (e) {
                console.error('Error deleting recipe:', e);
            }
        }

        document.getElementById('recipeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            try {
                const id = document.getElementById('recipeId').value || generateUUID();
                const section = document.getElementById('recipeSection').value;
                const name = document.getElementById('recipeName').value;
                const ingredients = document.getElementById('recipeIngredients').value.split('\n').filter(line => line.trim());
                const instructions = document.getElementById('recipeInstructions').value.split('\n').filter(line => line.trim());
                const notes = document.getElementById('recipeNotes').value;

                // Remove old recipe if editing
                if (document.getElementById('recipeId').value) {
                    Object.keys(recipes).forEach(sec => {
                        recipes[sec] = recipes[sec].filter(r => r.id !== id);
                    });
                }

                // Add new or updated recipe
                if (!recipes[section]) recipes[section] = [];
                recipes[section].push({ id, name, ingredients, instructions, notes });
                
                renderRecipes();
                updateShareUrl();
                closeModal();
                showMessage(document.getElementById('recipeId').value ? 'ƒê√£ c·∫≠p nh·∫≠t c√¥ng th·ª©c!' : 'ƒê√£ th√™m c√¥ng th·ª©c m·ªõi!');
            } catch (e) {
                console.error('Error submitting form:', e);
                showMessage('L·ªói khi l∆∞u c√¥ng th·ª©c', 'error');
            }
        });

        // Initialize
        try {
            // Try to load data from URL first
            if (!loadDataFromUrl()) {
                // If no URL data, use default recipes
                recipes = JSON.parse(JSON.stringify(defaultRecipes));
            }
            
            renderRecipes();
            updateShareUrl();
        } catch (e) {
            console.error('Initialization failed:', e);
            recipes = JSON.parse(JSON.stringify(defaultRecipes));
            renderRecipes();
            updateShareUrl();
        }
    </script>
</body>
</html>
