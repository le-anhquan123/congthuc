<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hướng Dẫn Công Thức Pha Chế</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Thêm Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        .accordion-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            text-align: left;
            font-weight: 600;
            font-size: 1.125rem;
            padding: 1rem;
            border: none;
            background: linear-gradient(to right, #f9fafb, #f3f4f6);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .accordion-button:hover {
            background: linear-gradient(to right, #f3f4f6, #e5e7eb);
        }
        .accordion-button::after {
            content: '\25BC';
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        .accordion-button.open::after {
            transform: rotate(180deg);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            background-color: #f9fafb;
            color: #4b5563;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
        }
        .accordion-content.open {
            max-height: 2000px;
            padding: 1rem;
        }
        .nav-link {
            transition: all 0.2s ease;
            display: block;
            padding: 0.5rem 0;
        }
        .nav-link:hover {
            color: #2563eb;
            transform: translateX(5px);
        }
        .section-title {
            position: relative;
            display: inline-block;
            margin-bottom: 1.5rem;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 50%;
            height: 3px;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        .section-title:hover::after {
            width: 100%;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal.open {
            display: flex;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .error-message {
            background: #fee2e2;
            color: #b91c1c;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-8 text-center shadow-lg">
        <h1 class="text-4xl font-bold tracking-tight hover:text-blue-200 transition-colors duration-300">Hướng Dẫn Công Thức Pha Chế</h1>
    </header>

    <main class="container mx-auto p-6 max-w-5xl">
        <div id="messages"></div>

        <div class="mb-6 flex flex-wrap gap-2">
            <button onclick="openModal('add')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                Thêm Công Thức
            </button>
            <button onclick="resetToDefault()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                Khôi phục mặc định
            </button>
        </div>

        <nav class="bg-white shadow-xl rounded-2xl p-6 mb-8 transition-transform duration-300 hover:shadow-2xl">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 section-title">Mục Lục</h2>
            <ul class="space-y-2">
                <li><a href="#feca" class="text-blue-600 hover:underline nav-link">Feca Pha Chế</a></li>
                <li><a href="#coffee" class="text-blue-600 hover:underline nav-link">Cà Phê</a></li>
                <li><a href="#frappe" class="text-blue-600 hover:underline nav-link">Đá Xay</a></li>
                <li><a href="#matcha" class="text-blue-600 hover:underline nav-link">Matcha</a></li>
                <li><a href="#tea" class="text-blue-600 hover:underline nav-link">Trà Sữa & Trà</a></li>
            </ul>
        </nav>

        <section id="feca" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Feca Pha Chế</h2>
            <div class="space-y-4" id="feca-recipes"></div>
        </section>

        <section id="coffee" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Cà Phê</h2>
            <div class="space-y-4" id="coffee-recipes"></div>
        </section>

        <section id="matcha" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Matcha</h2>
            <div class="space-y-4" id="matcha-recipes"></div>
        </section>

        <section id="frappe" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Đá Xay</h2>
            <div class="space-y-4" id="frappe-recipes"></div>
        </section>

        <section id="tea" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Trà Sữa & Trà</h2>
            <div class="space-y-4" id="tea-recipes"></div>
        </section>

        <div id="recipeModal" class="modal">
            <div class="modal-content">
                <h2 id="modalTitle">Thêm Công Thức</h2>
                <form id="recipeForm" class="space-y-4">
                    <div>
                        <label for="recipeName" class="block font-medium mb-1">Tên Công Thức</label>
                        <input type="text" id="recipeName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="recipeSection" class="block font-medium mb-1">Phần</label>
                        <select id="recipeSection" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="feca">Feca Pha Chế</option>
                            <option value="coffee">Cà Phê</option>
                            <option value="frappe">Đá Xay</option>
                            <option value="matcha">Matcha</option>
                            <option value="tea">Trà Sữa & Trà</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="recipeIngredients" class="block font-medium mb-1">Nguyên Liệu</label>
                        <textarea id="recipeIngredients" rows="3" placeholder="Nhập nguyên liệu (mỗi dòng một nguyên liệu)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div>
                        <label for="recipeInstructions" class="block font-medium mb-1">Cách Làm</label>
                        <textarea id="recipeInstructions" rows="3" placeholder="Nhập cách làm (mỗi dòng một bước)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div>
                        <label for="recipeNotes" class="block font-medium mb-1">Ghi Chú (Tùy chọn)</label>
                        <textarea id="recipeNotes" rows="2" placeholder="Nhập ghi chú nếu có" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <input type="hidden" id="recipeId">
                    
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors">
                            Hủy
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                            Lưu
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white text-center py-6">
        <p class="text-sm">© 2025 Công Thức Pha Chế</p>
        <p class="text-sm mt-2">Liên hệ: <a href="mailto:info@phache.com" class="hover:text-blue-300 transition-colors">info@phache.com</a></p>
    </footer>

    <script>
        // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCrwM59zHPK6Bd9MP47G6Z4T74L1G9rL5s",
  authDomain: "congthuc-d0472.firebaseapp.com",
  projectId: "congthuc-d0472",
  storageBucket: "congthuc-d0472.firebasestorage.app",
  messagingSenderId: "896780892378",
  appId: "1:896780892378:web:89fa071ca332866f184de3",
  measurementId: "G-XLF8M5D9BP"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

        // Default recipes data
        const defaultRecipes = {
            feca: [
                { id: 'feca1', name: 'Công thức nấu Tofu', ingredients: ['Bột tofu (tàu hủ): 100g', 'Nước: 500ml'], instructions: ['Giảm lửa xuống 800 (riu lửa).', 'Vừa đổ bột vào vừa khuấy đều bằng muỗng.', 'Khuấy xong, vừa lên tím thì tắt lửa.', 'Cho trực tiếp vào hủ đựng tofu với 40g.'], notes: '' },
                // ... (giữ nguyên các công thức mặc định khác)
            ],
            coffee: [
                // ... (giữ nguyên các công thức mặc định)
            ],
            matcha: [
                // ... (giữ nguyên các công thức mặc định)
            ],
            frappe: [
                // ... (giữ nguyên các công thức mặc định)
            ],
            tea: [
                // ... (giữ nguyên các công thức mặc định)
            ]
        };

        let recipes = {};

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function showMessage(message, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        function resetToDefault() {
            if (confirm('Bạn có chắc muốn khôi phục về công thức mặc định? Tất cả thay đổi sẽ bị mất.')) {
                recipes = JSON.parse(JSON.stringify(defaultRecipes));
                saveRecipes();
                renderRecipes();
                showMessage('Đã khôi phục về công thức mặc định!');
            }
        }

        function toggleAccordion(button) {
            const content = button.nextElementSibling;
            button.classList.toggle('open');
            content.classList.toggle('open');
        }

        function openModal(mode, recipe = null) {
            const modal = document.getElementById('recipeModal');
            const form = document.getElementById('recipeForm');
            const title = document.getElementById('modalTitle');
            
            if (mode === 'edit' && recipe) {
                title.textContent = 'Sửa Công Thức';
                document.getElementById('recipeName').value = recipe.name;
                document.getElementById('recipeSection').value = recipe.section || 'frappe';
                document.getElementById('recipeIngredients').value = recipe.ingredients.join('\n');
                document.getElementById('recipeInstructions').value = recipe.instructions.join('\n');
                document.getElementById('recipeNotes').value = recipe.notes || '';
                document.getElementById('recipeId').value = recipe.id;
            } else {
                title.textContent = 'Thêm Công Thức';
                form.reset();
                document.getElementById('recipeId').value = '';
            }

            modal.classList.add('open');
        }

        function closeModal() {
            document.getElementById('recipeModal').classList.remove('open');
        }

        function renderRecipes() {
            const sections = ['feca', 'coffee', 'frappe', 'matcha', 'tea'];
            
            sections.forEach(section => {
                const container = document.getElementById(`${section}-recipes`);
                if (!container) return;
                
                container.innerHTML = '';
                
                if (!recipes[section] || !Array.isArray(recipes[section])) {
                    container.innerHTML = '<div class="error-message">Không tìm thấy công thức. Vui lòng thêm công thức mới.</div>';
                    return;
                }
                
                recipes[section].forEach(recipe => {
                    const recipeDiv = document.createElement('div');
                    recipeDiv.className = 'bg-white shadow-md rounded-xl overflow-hidden';
                    
                    recipeDiv.innerHTML = `
                        <button class="accordion-button" onclick="toggleAccordion(this)">
                            ${recipe.name}
                        </button>
                        <div class="accordion-content">
                            ${recipe.ingredients.length ? `
                                <p class="font-medium mb-1">Nguyên liệu:</p>
                                <ul class="list-disc pl-6 mb-3">
                                    ${recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}
                                </ul>
                            ` : ''}
                            
                            ${recipe.instructions.length ? `
                                <p class="font-medium mb-1">Cách làm:</p>
                                <ul class="list-disc pl-6 mb-3">
                                    ${recipe.instructions.map(ins => `<li>${ins}</li>`).join('')}
                                </ul>
                            ` : ''}
                            
                            ${recipe.notes ? `
                                <p class="font-medium mb-1">Ghi chú:</p>
                                <p class="pl-2">${recipe.notes}</p>
                            ` : ''}
                        </div>
                        <div class="flex justify-end p-2 bg-gray-50 border-t">
                            <button onclick="editRecipe('${recipe.id}', '${section}')" class="text-blue-600 hover:text-blue-800 mr-2 px-3 py-1 rounded hover:bg-blue-50">
                                Sửa
                            </button>
                            <button onclick="deleteRecipe('${recipe.id}', '${section}')" class="text-red-600 hover:text-red-800 px-3 py-1 rounded hover:bg-red-50">
                                Xóa
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(recipeDiv);
                });
            });
        }

        function editRecipe(id, section) {
            const recipe = recipes[section].find(r => r.id === id);
            if (recipe) {
                openModal('edit', { ...recipe, section });
            }
        }

        function deleteRecipe(id, section) {
            if (confirm('Bạn có chắc muốn xóa công thức này?')) {
                recipes[section] = recipes[section].filter(r => r.id !== id);
                saveRecipes();
                renderRecipes();
                showMessage('Đã xóa công thức!');
            }
        }

        // Hàm lưu recipes lên Firebase
        function saveRecipes() {
            database.ref('recipes').set(recipes)
                .then(() => console.log('Recipes saved to Firebase'))
                .catch((error) => {
                    console.error('Failed to save recipes:', error);
                    showMessage('Lỗi khi lưu công thức', 'error');
                });
        }

        // Hàm load recipes từ Firebase
        function loadRecipes() {
            database.ref('recipes').once('value').then((snapshot) => {
                const data = snapshot.val();
                if (data) {
                    recipes = data;
                    console.log('Loaded recipes from Firebase');
                } else {
                    recipes = JSON.parse(JSON.stringify(defaultRecipes));
                    saveRecipes();
                    console.log('No recipes in Firebase, using default');
                }
                renderRecipes();
            }).catch((error) => {
                console.error('Failed to load recipes:', error);
                recipes = JSON.parse(JSON.stringify(defaultRecipes));
                renderRecipes();
                showMessage('Lỗi khi tải công thức', 'error');
            });
        }

        // Xử lý submit form
        document.getElementById('recipeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('recipeId').value || generateUUID();
            const section = document.getElementById('recipeSection').value;
            const name = document.getElementById('recipeName').value.trim();
            const ingredients = document.getElementById('recipeIngredients').value
                .split('\n')
                .filter(line => line.trim());
            const instructions = document.getElementById('recipeInstructions').value
                .split('\n')
                .filter(line => line.trim());
            const notes = document.getElementById('recipeNotes').value.trim();

            if (!name) {
                showMessage('Vui lòng nhập tên công thức', 'error');
                return;
            }

            // Remove old recipe if editing
            if (document.getElementById('recipeId').value) {
                Object.keys(recipes).forEach(sec => {
                    recipes[sec] = recipes[sec].filter(r => r.id !== id);
                });
            }

            // Add new recipe
            if (!recipes[section]) recipes[section] = [];
            recipes[section].push({ 
                id, 
                name, 
                ingredients, 
                instructions, 
                notes 
            });
            
            saveRecipes();
            renderRecipes();
            closeModal();
            showMessage(
                document.getElementById('recipeId').value 
                    ? 'Đã cập nhật công thức!' 
                    : 'Đã thêm công thức mới!'
            );
        });

        // Khởi tạo ứng dụng
        document.addEventListener('DOMContentLoaded', () => {
            loadRecipes();
        });
    </script>
</body>
</html>
