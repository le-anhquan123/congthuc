<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hướng Dẫn Công Thức Pha Chế</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        .accordion-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            text-left: p-5;
            font-semibold: text-lg;
            bg-gradient-to-r: from-gray-50 to-gray-100;
            text-gray-700;
            padding: 1rem;
            border: none;
            background: linear-gradient(to right, #f9fafb, #f3f4f6);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .accordion-button:hover {
            background-color: #e5e7eb;
        }
        .accordion-button::after {
            content: '\25BC';
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        .accordion-button.open::after {
            transform: rotate(180deg);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            padding: 0 1rem;
            background-color: #f9fafb;
            color: #4b5563;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
        }
        .accordion-content.open {
            max-height: 2000px;
            padding: 1rem;
        }
        .nav-link {
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .nav-link:hover {
            color: #1d4ed8;
            transform: translateX(5px);
        }
        .section-title {
            position: relative;
            display: inline-block;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 50%;
            height: 3px;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        .section-title:hover::after {
            width: 100%;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal.open {
            display: flex;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .modal-content h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .modal-content label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .modal-content input, .modal-content textarea, .modal-content select {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }
        .modal-content textarea {
            min-height: 100px;
        }
        .modal-content button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            margin-right: 0.5rem;
        }
        .error-message {
            background: #fee2e2;
            color: #b91c1c;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-8 text-center shadow-lg">
        <h1 class="text-4xl font-bold tracking-tight hover:text-blue-200 transition-colors duration-300">Hướng Dẫn Công Thức Pha Chế</h1>
    </header>

    <main class="container mx-auto p-6 max-w-5xl">
        <div id="messages"></div>

        <div class="mb-6">
            <button onclick="openModal('add')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-2">Thêm Công Thức</button>
            <button onclick="resetToDefault()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">Khôi phục mặc định</button>
        </div>

        <nav class="bg-white shadow-xl rounded-2xl p-6 mb-8 transform hover:scale-[1.01] transition-transform duration-300">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 section-title">Mục Lục</h2>
            <ul class="space-y-3">
                <li><a href="#feca" class="text-blue-600 hover:underline nav-link block">Feca Pha Chế</a></li>
                <li><a href="#coffee" class="text-blue-600 hover:underline nav-link block">Cà Phê</a></li>
                <li><a href="#frappe" class="text-blue-600 hover:underline nav-link block">Đá Xay</a></li>
                <li><a href="#matcha" class="text-blue-600 hover:underline nav-link block">Matcha</a></li>
                <li><a href="#tea" class="text-blue-600 hover:underline nav-link block">Trà Sữa & Trà</a></li>
            </ul>
        </nav>

        <section id="feca" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Feca Pha Chế</h2>
            <div class="space-y-4" id="feca-recipes"></div>
        </section>

        <section id="coffee" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Cà Phê</h2>
            <div class="space-y-4" id="coffee-recipes"></div>
        </section>

        <section id="matcha" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Matcha</h2>
            <div class="space-y-4" id="matcha-recipes"></div>
        </section>

        <section id="frappe" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Đá Xay</h2>
            <div class="space-y-4" id="frappe-recipes"></div>
        </section>

        <section id="tea" class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Trà Sữa & Trà</h2>
            <div class="space-y-4" id="tea-recipes"></div>
        </section>

        <div id="recipeModal" class="modal">
            <div class="modal-content">
                <h2 id="modalTitle">Thêm Công Thức</h2>
                <form id="recipeForm">
                    <label for="recipeName">Tên Công Thức</label>
                    <input type="text" id="recipeName" required>
                    <label for="recipeSection">Phần</label>
                    <select id="recipeSection" required>
                        <option value="feca">Feca Pha Chế</option>
                        <option value="coffee">Cà Phê</option>
                        <option value="frappe">Đá Xay</option>
                        <option value="matcha">Matcha</option>
                        <option value="tea">Trà Sữa & Trà</option>
                    </select>
                    <label for="recipeIngredients">Nguyên Liệu</label>
                    <textarea id="recipeIngredients" placeholder="Nhập nguyên liệu (mỗi dòng một nguyên liệu)"></textarea>
                    <label for="recipeInstructions">Cách Làm</label>
                    <textarea id="recipeInstructions" placeholder="Nhập cách làm (mỗi dòng một bước)"></textarea>
                    <label for="recipeNotes">Ghi Chú (Tùy chọn)</label>
                    <textarea id="recipeNotes" placeholder="Nhập ghi chú nếu có"></textarea>
                    <input type="hidden" id="recipeId">
                    <div class="flex justify-end">
                        <button type="button" onclick="closeModal()" class="bg-gray-500 text-white hover:bg-gray-600">Hủy</button>
                        <button type="submit" class="bg-blue-600 text-white hover:bg-blue-700">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white text-center py-6">
        <p class="text-sm">© 2025 Công Thức Pha Chế</p>
        <p class="text-sm mt-2">Liên hệ: <a href="mailto:info@phache.com" class="hover:text-blue-300 transition-colors">info@phache.com</a></p>
    </footer>

    <script>
        // Default recipes data
        const defaultRecipes = {
            feca: [
                { id: 'feca1', name: 'Công thức nấu Tofu', ingredients: ['Bột tofu (tàu hủ): 100g', 'Nước: 500ml'], instructions: ['Giảm lửa xuống 800 (riu lửa).', 'Vừa đổ bột vào vừa khuấy đều bằng muỗng.', 'Khuấy xong, vừa lên tím thì tắt lửa.', 'Cho trực tiếp vào hủ đựng tofu với 40g.'], notes: '' },
                { id: 'feca2', name: 'Công thức nấu Hồng Trà (Trà trái cây)', ingredients: ['Hồng trà: 100g', 'Nước: 1.400ml', 'Đá: 400g'], instructions: ['Để nước sôi vào ca đong, bấm đồng hồ 2 phút để giảm nhiệt độ nước.', 'Bỏ trà vào, đậy nắp hở, ủ trong 12 phút.', 'Ủ xong, lấy ra cho chảy hết nước tự nhiên (không vắt).', 'Cho đá vào.'], notes: '' },
                { id: 'feca3', name: 'Công thức nấu Olong + Hồng Trà (Olong Sữa, 2 mẻ)', ingredients: ['Olong: 160g', 'Hồng trà: 40g', 'Nước: 2.000ml', 'Nước đá: 400g'], instructions: ['Ủ trong 20 phút.', 'Cho nước đá vào.'], notes: '' },
                { id: 'feca4', name: 'Công thức nấu Hồng Trà Sữa (2 mẻ)', ingredients: ['Hồng trà: 200g', 'Nước: 2.000ml', 'Nước đá: 400g'], instructions: ['Ủ trong 20 phút.', 'Cho nước đá vào.'], notes: '' },
                { id: 'feca5', name: 'Kem Sữa', ingredients: ['Sữa tươi (khối lượng nhỏ): 50g', 'ON TOP (khối lượng nhỏ): 105g', 'Sữa tươi (khối lượng lớn): 100g', 'ON TOP (khối lượng lớn): 210g'], instructions: [], notes: 'Cho toàn bộ nguyên liệu vào ca, khuấy đều cho hợp, nguyên liệu có thể, sau đó sử dụng máy đánh kem đánh ở mức 4 trong 35s thêm 5s nếu thấy vẫn còn lỏng.' }
            ],
            coffee: [
                { id: 'coffee1', name: 'Espresso Đá', ingredients: ['Cà phê máy 1 shot', '80% ngọt: 6ml đường', '100% ngọt: 8ml đường', '120% ngọt: 10ml đường'], instructions: ['Trình bày đá riêng'], notes: '' },
                { id: 'coffee2', name: 'Espresso Sữa Đá', ingredients: ['Cà phê máy 1 shot', '80% ngọt: 14g sữa đặc', '100% ngọt: 28g sữa đặc', '120% ngọt: 42g sữa đặc'], instructions: ['Trình bày đá riêng'], notes: '' }
            ],
            matcha: [
                { id: 'matcha1', name: 'Matcha Coco', ingredients: ['Nước dừa: 150ml', 'Nước đường: 23g (2 pump)', 'Kem Matcha: 70g (150ml)'], instructions: ['Khuấy đều sau đó đổ đá ngang miệng ly, trang trí bột matcha'], notes: '' }
            ],
            frappe: [
                { id: 'frappe1', name: 'Cookie Đá Xay', ingredients: ['5 Oreo (4.5 cho vào cối, 0.5 trang trí)', 'Sữa tươi: 70g', 'Rick lùn: 60g', 'Bột Frappe: 20g', 'Đường cát: 30g', '1 ly đá L'], instructions: ['Xay hỗn hợp tới khi đá nát và đổ ra ly, xịt kem lên trên và trang trí 0.5 Oreo đập vụn rắc lên bề mặt'], notes: '' }
            ],
            tea: [
                { id: 'tea1', name: 'Feca Olong Sữa', ingredients: ['Cốt trà sữa olong: 80g (size M), 120g (size L)', 'Bột sữa Frima: 10g (size M), 15g (size L)', 'Sữa đặc Lamosa 80%: 23g (size M), 45g (size L)', 'Sữa đặc Lamosa 100%: 45g (size M), 60g (size L)', 'Sữa đặc Lamosa 120%: 60g (size M), 75g (size L)'], instructions: ['Khuấy đều nhẹ tay, sử dụng sục để đánh vị và hương lên, sau khi sục khuấy tan bột sữa và cho đá vào'], notes: '1 pump = 12/13g' }
            ]
        };

        let recipes = JSON.parse(JSON.stringify(defaultRecipes));

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function showMessage(message, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        function resetToDefault() {
            if (confirm('Bạn có chắc muốn khôi phục về công thức mặc định? Tất cả thay đổi sẽ bị mất.')) {
                recipes = JSON.parse(JSON.stringify(defaultRecipes));
                renderRecipes();
                showMessage('Đã khôi phục về công thức mặc định!');
            }
        }

        function toggleAccordion(button) {
            try {
                const content = button.nextElementSibling;
                if (!content || !content.classList.contains('accordion-content')) {
                    return;
                }
                const isOpen = content.classList.contains('open');
                content.classList.toggle('open', !isOpen);
                button.classList.toggle('open', !isOpen);
            } catch (e) {
                console.error('Error in toggleAccordion:', e);
            }
        }

        function openModal(mode, recipe = null) {
            try {
                const modal = document.getElementById('recipeModal');
                const form = document.getElementById('recipeForm');
                const title = document.getElementById('modalTitle');
                const recipeName = document.getElementById('recipeName');
                const recipeSection = document.getElementById('recipeSection');
                const recipeIngredients = document.getElementById('recipeIngredients');
                const recipeInstructions = document.getElementById('recipeInstructions');
                const recipeNotes = document.getElementById('recipeNotes');
                const recipeId = document.getElementById('recipeId');

                if (mode === 'edit' && recipe) {
                    title.textContent = 'Sửa Công Thức';
                    recipeName.value = recipe.name;
                    recipeSection.value = recipe.section || 'frappe';
                    recipeIngredients.value = recipe.ingredients.join('\n');
                    recipeInstructions.value = recipe.instructions.join('\n');
                    recipeNotes.value = recipe.notes || '';
                    recipeId.value = recipe.id;
                } else {
                    title.textContent = 'Thêm Công Thức';
                    form.reset();
                    recipeId.value = '';
                }

                modal.classList.add('open');
            } catch (e) {
                console.error('Error opening modal:', e);
            }
        }

        function closeModal() {
            try {
                document.getElementById('recipeModal').classList.remove('open');
            } catch (e) {
                console.error('Error closing modal:', e);
            }
        }

        function renderRecipes() {
            try {
                const sections = ['feca', 'coffee', 'frappe', 'matcha', 'tea'];
                sections.forEach(section => {
                    const container = document.getElementById(`${section}-recipes`);
                    if (!container) {
                        return;
                    }
                    container.innerHTML = '';

                    if (!recipes[section] || !Array.isArray(recipes[section])) {
                        container.innerHTML = `<div class="error-message">Không tìm thấy công thức cho ${section}. Vui lòng thêm công thức mới.</div>`;
                        return;
                    }

                    recipes[section].forEach(recipe => {
                        const recipeDiv = document.createElement('div');
                        recipeDiv.className = 'bg-white shadow-md rounded-xl overflow-hidden';
                        recipeDiv.innerHTML = `
                            <button class="accordion-button w-full text-left p-5 font-semibold text-lg bg-gradient-to-r from-gray-50 to-gray-100 text-gray-700" onclick="toggleAccordion(this)">${recipe.name}</button>
                            <div class="accordion-content bg-gray-50 text-gray-600">
                                ${recipe.ingredients && recipe.ingredients.length ? `<p><strong>Nguyên liệu:</strong></p><ul class="list-disc pl-6">${recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}</ul>` : ''}
                                ${recipe.instructions && recipe.instructions.length ? `<p><strong>Cách làm:</strong></p><ul class="list-disc pl-6">${recipe.instructions.map(ins => `<li>${ins}</li>`).join('')}</ul>` : ''}
                                ${recipe.notes ? `<p><strong>Ghi chú:</strong> ${recipe.notes}</p>` : ''}
                            </div>
                            <div class="flex justify-end p-2">
                                <button onclick="editRecipe('${recipe.id}', '${section}')" class="text-blue-600 hover:text-blue-800 mr-2">Sửa</button>
                                <button onclick="deleteRecipe('${recipe.id}', '${section}')" class="text-red-600 hover:text-red-800">Xóa</button>
                            </div>
                        `;
                        container.appendChild(recipeDiv);
                    });
                });
            } catch (e) {
                console.error('Error in renderRecipes:', e);
            }
        }

        function editRecipe(id, section) {
            try {
                const recipe = recipes[section].find(r => r.id === id);
                if (recipe) {
                    openModal('edit', { ...recipe, section });
                }
            } catch (e) {
                console.error('Error editing recipe:', e);
            }
        }

        function deleteRecipe(id, section) {
            try {
                if (confirm('Bạn có chắc muốn xóa công thức này?')) {
                    recipes[section] = recipes[section].filter(r => r.id !== id);
                    renderRecipes();
                    showMessage('Đã xóa công thức!');
                }
            } catch (e) {
                console.error('Error deleting recipe:', e);
            }
        }

        document.getElementById('recipeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            try {
                const id = document.getElementById('recipeId').value || generateUUID();
                const section = document.getElementById('recipeSection').value;
                const name = document.getElementById('recipeName').value;
                const ingredients = document.getElementById('recipeIngredients').value.split('\n').filter(line => line.trim());
                const instructions = document.getElementById('recipeInstructions').value.split('\n').filter(line => line.trim());
                const notes = document.getElementById('recipeNotes').value;

                // Remove old recipe if editing
                if (document.getElementById('recipeId').value) {
                    Object.keys(recipes).forEach(sec => {
                        recipes[sec] = recipes[sec].filter(r => r.id !== id);
                    });
                }

                // Add new or updated recipe
                if (!recipes[section]) recipes[section] = [];
                recipes[section].push({ id, name, ingredients, instructions, notes });
                
                renderRecipes();
                closeModal();
                showMessage(document.getElementById('recipeId').value ? 'Đã cập nhật công thức!' : 'Đã thêm công thức mới!');
            } catch (e) {
                console.error('Error submitting form:', e);
                showMessage('Lỗi khi lưu công thức', 'error');
            }
        });

        // Initialize
        try {
            recipes = JSON.parse(JSON.stringify(defaultRecipes));
            renderRecipes();
        } catch (e) {
            console.error('Initialization failed:', e);
            recipes = JSON.parse(JSON.stringify(defaultRecipes));
            renderRecipes();
        }
    </script>
</body>
</html>
